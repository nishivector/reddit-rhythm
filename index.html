<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trending Rhythms</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            overflow: hidden; 
            background: #0a0a0f;
            font-family: 'Courier New', monospace;
        }
        #ui {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            background: linear-gradient(to bottom, rgba(10,10,15,0.9), transparent);
        }
        #github-link {
            position: fixed;
            bottom: 20px;
            right: 20px;
            color: #666;
            font-size: 14px;
            text-decoration: none;
            z-index: 100;
            opacity: 0.6;
            transition: opacity 0.3s;
        }
        #github-link:hover {
            opacity: 1;
            color: #fff;
        }
        #score, #combo {
            font-size: 24px;
            color: #00ff88;
            text-shadow: 0 0 20px #00ff88;
        }
        #combo {
            color: #ff00aa;
            text-shadow: 0 0 20px #ff00aa;
            opacity: 0;
            transition: opacity 0.2s;
        }
        #topic-bar {
            position: fixed;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 100;
        }
        .topic-pill {
            background: rgba(255,255,255,0.1);
            padding: 8px 16px;
            border-radius: 20px;
            color: #fff;
            font-size: 14px;
            border: 1px solid rgba(255,255,255,0.2);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        #lanes {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
        }
        .lane {
            width: 80px;
            height: 200px;
            border: 2px solid #333;
            border-radius: 10px;
            position: relative;
            background: rgba(0,0,0,0.5);
        }
        .lane.active {
            border-color: #00ff88;
            box-shadow: 0 0 30px rgba(0,255,136,0.3);
        }
        .lane-key {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            color: #666;
            font-size: 20px;
            font-weight: bold;
        }
        #hit-line {
            position: fixed;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            width: 400px;
            height: 4px;
            background: linear-gradient(90deg, transparent, #00ff88, transparent);
            z-index: 50;
        }
        #feedback {
            position: fixed;
            bottom: 200px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 36px;
            font-weight: bold;
            opacity: 0;
            transition: all 0.2s;
            z-index: 100;
        }
        #start-screen {
            position: fixed;
            inset: 0;
            background: rgba(10,10,15,0.98);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 200;
        }
        #start-screen h1 {
            font-size: 48px;
            color: #00ff88;
            text-shadow: 0 0 30px #00ff88;
            margin-bottom: 20px;
        }
        #start-screen p {
            color: #888;
            margin-bottom: 40px;
        }
        #start-btn {
            background: #00ff88;
            color: #0a0a0f;
            border: none;
            padding: 20px 60px;
            font-size: 24px;
            font-weight: bold;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
        }
        #start-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 40px #00ff88;
        }
        #game-over {
            position: fixed;
            inset: 0;
            background: rgba(10,10,15,0.95);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 200;
        }
        #game-over h2 {
            font-size: 48px;
            color: #ff00aa;
            margin-bottom: 20px;
        }
        #game-over button {
            background: #ff00aa;
            color: #fff;
            border: none;
            padding: 15px 50px;
            font-size: 20px;
            border-radius: 25px;
            cursor: pointer;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div id="ui">
        <div id="score">SCORE: 0</div>
        <div id="combo">COMBO x1</div>
    </div>
    <div id="topic-bar"></div>
    <div id="hit-line"></div>
    <div id="lanes">
        <div class="lane" data-key="A"><span class="lane-key">A</span></div>
        <div class="lane" data-key="S"><span class="lane-key">S</span></div>
        <div class="lane" data-key="D"><span class="lane-key">D</span></div>
        <div class="lane" data-key="F"><span class="lane-key">F</span></div>
    </div>
    <div id="feedback">PERFECT!</div>
    <a id="github-link" href="https://github.com/nishivector/reddit-rally" target="_blank">View Source</a>
    
    <div id="start-screen">
        <h1>üéµ TRENDING RHYTHMS</h1>
        <p>Hit the keys when the topics reach the line!</p>
        <button id="start-btn">START</button>
    </div>
    
    <div id="game-over">
        <h2>GAME OVER</h2>
        <p id="final-score" style="color:#fff;font-size:24px">Score: 0</p>
        <p id="max-combo" style="color:#ff00aa;font-size:20px">Max Combo: 0</p>
        <button onclick="restart()">PLAY AGAIN</button>
    </div>

    <script type="module">
        // Tone.js - Audio
        import * as Tone from 'https://cdn.jsdelivr.net/npm/tone@14.8.49/+esm';

        // Game state
        let score = 0;
        let combo = 0;
        let maxCombo = 0;
        let gameRunning = false;
        let bpm = 120;
        
        // Trending topics
        const trendingTopics = [
            { text: "Congress", emoji: "üìú", lane: 0, color: "#3498db" },
            { text: "Jordan", emoji: "üèÄ", lane: 1, color: "#e67e22" },
            { text: "Daytona", emoji: "üèéÔ∏è", lane: 2, color: "#e74c3c" },
            { text: "AI", emoji: "ü§ñ", lane: 3, color: "#1abc9c" },
            { text: "Climate", emoji: "üåç", lane: 2, color: "#2ecc71" },
            { text: "Space", emoji: "üöÄ", lane: 0, color: "#9b59b6" },
            { text: "Tech", emoji: "üíª", lane: 1, color: "#34495e" },
            { text: "Sports", emoji: "‚öΩ", lane: 3, color: "#f39c12" }
        ];

        const keys = ['a', 's', 'd', 'f'];
        const notes = ['C4', 'D4', 'E4', 'F4'];
        
        // Synths
        let synths = [];
        let hitSynth;
        
        async function initAudio() {
            await Tone.start();
            
            // Create synth for each lane
            for (let i = 0; i < 4; i++) {
                const synth = new Tone.Synth({
                    oscillator: { type: i % 2 === 0 ? 'triangle' : 'sine' },
                    envelope: { attack: 0.01, decay: 0.1, sustain: 0.3, release: 0.5 }
                }).toDestination();
                synth.volume.value = -10;
                synths.push(synth);
            }
            
            // Hit sound
            hitSynth = new Tone.MembraneSynth({
                pitchDecay: 0.05,
                octaves: 4,
                oscillator: { type: 'sine' },
                envelope: { attack: 0.001, decay: 0.2, sustain: 0, release: 0.5 }
            }).toDestination();
            hitSynth.volume.value = -5;
        }

        // UI Elements
        const scoreEl = document.getElementById('score');
        const comboEl = document.getElementById('combo');
        const feedbackEl = document.getElementById('feedback');
        const topicBar = document.getElementById('topic-bar');
        const lanesEl = document.querySelectorAll('.lane');
        
        // Current topics display
        let currentTopics = [];
        
        function updateTopicBar() {
            currentTopics = [];
            const shuffled = [...trendingTopics].sort(() => Math.random() - 0.5);
            for (let i = 0; i < 4; i++) {
                currentTopics.push(shuffled[i]);
            }
            
            topicBar.innerHTML = currentTopics.map(t => 
                `<span class="topic-pill" style="border-color:${t.color}">${t.emoji} ${t.text}</span>`
            ).join('');
        }
        
        // Notes falling
        const notesEl = [];
        const noteSpeed = 400; // pixels per second
        
        function spawnNote(laneIndex) {
            const note = document.createElement('div');
            note.className = 'note';
            note.dataset.lane = laneIndex;
            note.dataset.active = 'true';
            note.style.cssText = `
                position: fixed;
                left: ${50 + (laneIndex - 1.5) * 100}px;
                top: -50px;
                width: 70px;
                height: 70px;
                border-radius: 50%;
                background: ${currentTopics[laneIndex]?.color || '#00ff88'};
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 30px;
                box-shadow: 0 0 20px ${currentTopics[laneIndex]?.color || '#00ff88'};
                z-index: 60;
            `;
            note.textContent = currentTopics[laneIndex]?.emoji || '‚ô™';
            document.body.appendChild(note);
            notesEl.push({ el: note, y: -50, lane: laneIndex, time: Date.now() });
        }

        // Input handling
        const keyState = {};
        
        window.addEventListener('keydown', (e) => {
            const key = e.key.toLowerCase();
            if (keys.includes(key) && !keyState[key]) {
                keyState[key] = true;
                const laneIndex = keys.indexOf(key);
                lanesEl[laneIndex].classList.add('active');
                
                // Play sound
                if (synths[laneIndex]) {
                    synths[laneIndex].triggerAttackRelease(notes[laneIndex], '8n');
                }
                
                // Check hit
                checkHit(laneIndex);
            }
        });
        
        window.addEventListener('keyup', (e) => {
            const key = e.key.toLowerCase();
            if (keys.includes(key)) {
                keyState[key] = false;
                lanesEl[keys.indexOf(key)].classList.remove('active');
            }
        });

        function checkHit(laneIndex) {
            const hitY = window.innerHeight - 280;
            const hitWindow = 80;
            
            let hit = false;
            for (let i = notesEl.length - 1; i >= 0; i--) {
                const note = notesEl[i];
                if (note.lane === laneIndex && note.el.dataset.active === 'true') {
                    const diff = Math.abs(note.y - hitY);
                    if (diff < hitWindow) {
                        hit = true;
                        note.el.dataset.active = 'false';
                        note.el.style.opacity = '0';
                        note.el.style.transform = 'scale(1.5)';
                        
                        // Score based on accuracy
                        let points = 0;
                        let feedback = '';
                        let feedbackColor = '#00ff88';
                        
                        if (diff < 25) {
                            points = 300;
                            feedback = 'PERFECT!';
                            feedbackColor = '#00ff88';
                        } else if (diff < 50) {
                            points = 150;
                            feedback = 'GREAT!';
                            feedbackColor = '#00ffaa';
                        } else {
                            points = 50;
                            feedback = 'GOOD';
                            feedbackColor = '#ffaa00';
                        }
                        
                        combo++;
                        if (combo > maxCombo) maxCombo = combo;
                        
                        score += points * (1 + Math.floor(combo / 10) * 0.1);
                        
                        showFeedback(feedback, feedbackColor);
                        
                        // Hit sound
                        if (hitSynth) {
                            hitSynth.triggerAttackRelease('C2', '16n');
                        }
                        
                        setTimeout(() => note.el.remove(), 200);
                        notesEl.splice(i, 1);
                        break;
                    }
                }
            }
            
            if (!hit) {
                combo = 0;
                showFeedback('MISS', '#ff0066');
            }
            
            updateUI();
        }

        function showFeedback(text, color) {
            feedbackEl.textContent = text;
            feedbackEl.style.color = color;
            feedbackEl.style.textShadow = `0 0 30px ${color}`;
            feedbackEl.style.opacity = '1';
            feedbackEl.style.transform = 'translateX(-50%) scale(1.2)';
            
            setTimeout(() => {
                feedbackEl.style.opacity = '0';
                feedbackEl.style.transform = 'translateX(-50%) scale(1)';
            }, 300);
        }

        function updateUI() {
            scoreEl.textContent = `SCORE: ${Math.floor(score)}`;
            if (combo > 1) {
                comboEl.textContent = `COMBO x${combo}`;
                comboEl.style.opacity = '1';
            } else {
                comboEl.style.opacity = '0';
            }
        }

        // Game loop
        let lastSpawn = 0;
        const spawnInterval = 800;
        
        function gameLoop(timestamp) {
            if (!gameRunning) return;
            
            const delta = timestamp - lastSpawn;
            
            // Spawn notes
            if (delta > spawnInterval) {
                const lane = Math.floor(Math.random() * 4);
                spawnNote(lane);
                lastSpawn = timestamp;
            }
            
            // Move notes
            const hitY = window.innerHeight - 280;
            for (let i = notesEl.length - 1; i >= 0; i--) {
                const note = notesEl[i];
                if (note.el.dataset.active === 'false') continue;
                
                note.y += (noteSpeed / 60) * 1.5;
                note.el.style.top = `${note.y}px`;
                
                // Missed note
                if (note.y > hitY + 100) {
                    note.el.remove();
                    notesEl.splice(i, 1);
                    combo = 0;
                    showFeedback('MISS', '#ff0066');
                    updateUI();
                }
            }
            
            requestAnimationFrame(gameLoop);
        }

        function startGame() {
            document.getElementById('start-screen').style.display = 'none';
            gameRunning = true;
            score = 0;
            combo = 0;
            maxCombo = 0;
            updateTopicBar();
            updateUI();
            lastSpawn = performance.now();
            requestAnimationFrame(gameLoop);
        }

        function restart() {
            document.getElementById('game-over').style.display = 'none';
            notesEl.forEach(n => n.el.remove());
            notesEl.length = 0;
            gameRunning = true;
            score = 0;
            combo = 0;
            updateTopicBar();
            updateUI();
            lastSpawn = performance.now();
            requestAnimationFrame(gameLoop);
        }

        // Start button
        document.getElementById('start-btn').addEventListener('click', async () => {
            await initAudio();
            startGame();
        });

        // Keyboard start
        window.addEventListener('keydown', (e) => {
            if (!gameRunning && document.getElementById('start-screen').style.display !== 'none') {
                if (['a','s','d','f',' '].includes(e.key.toLowerCase())) {
                    document.getElementById('start-btn').click();
                }
            }
        });
    </script>
</body>
</html>
